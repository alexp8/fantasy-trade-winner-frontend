<div *ngIf="(!tradeResponse && !loading)" class="centered-input">
  <app-trade-home (sleeperLeagueIdChange)="onLeagueIdChange($event)"></app-trade-home>
  <div *ngIf="error" class="error">{{ error }}</div>
</div>
<div class="main-container">
  <div class="trade-left-nav">
    <div *ngIf="loading && !tradeResponse" class="trade-item">
      <img src="{{ where_them_trades_at_url }}" alt="Loading..." class="loading-img" />
    </div>
    <div *ngIf="tradeResponse" class="trade-header-container">
      <div class="league-name" id="league-name">
        <img [src]="getLeagueAvatar()" alt="League Avatar" class="league-avatar" />
        <h3>{{ tradeResponse.league_name }}</h3>
      </div>
    </div>

    <div *ngIf="tradeResponse || loading" class="trade-results-container" id="trade-results-container">
      <div *ngIf="tradeResponse" style="padding-left: 10px">
        <p>{{ tradeResponse.total_trades }} trades found</p>

        <div class="custom-dropdown">
          <div class="selected-option" (click)="toggleDropdown()">
            {{ selectedUser?.user_name || 'All' }}
          </div>

          <ul *ngIf="dropdownOpen" class="options-list">
            <li (click)="selectUser()">
              <span>All</span>
            </li>
            <li *ngFor="let user of tradeResponse.league_users" (click)="selectUser(user.roster_id)">
              <img [src]="getRosterAvatar(user.roster_id)" alt="{{ user.user_name }}'s Avatar"
                class="avatar-dropdown" />
              <span>{{ user.user_name }}</span>
            </li>
          </ul>
        </div>

        <!-- Pagination controls at the top -->
        <app-trade-pagination [loading]="loading" [tradeResponse]="tradeResponse" [currentPage]="currentPage"
          (fetchTradesEvent)="fetchTrades($event)">
        </app-trade-pagination>
      </div>

      <!-- Scrollable trade list -->
      <div class="scrollable-trade-list">
        <div *ngIf="loading" class="trade-item">
          <div *ngFor="let i of [].constructor(20)">
            <img src="{{ where_them_trades_at_url }}" alt="Loading..." class="loading-img" />
          </div>
        </div>
        <div *ngIf="!loading">
          <div *ngFor="let trade of tradeResponse?.trades" class="trade-item"
            [ngClass]="{'selected': trade === selectedTrade}" (click)="selectTrade(trade)">
            <p>{{ trade.created_at_pretty }}</p>
            <div class="scrollable-trade-list-item-container">
              <div class="left-align">
                <app-trade-scroll-item [tradeData]="trade[trade.roster_ids[0]]">
                </app-trade-scroll-item>
              </div>
              <div class="right-align">
                <app-trade-scroll-item [tradeData]="trade[trade.roster_ids[1]]">
                </app-trade-scroll-item>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="divider">

  </div>

  <!-- Full details of the selected trade -->
  <div class="trade-details" id="trade-details" *ngIf="selectedTrade">
    <div *ngIf="selectedTrade">
      <p>{{ selectedTrade.created_at_pretty }}</p>

      <!-- Roster container to display rosters side by side -->
      <div class="roster-container">

        <!-- Loop through roster IDs and display TradeRoster details -->
        <div *ngFor="let rosterId of selectedTrade.roster_ids" class="roster-block"
          [ngClass]="{'roster-won': selectedTrade[rosterId].won, 'roster-lost': !selectedTrade[rosterId].won}">

          <!-- Check if the TradeRoster exists for this rosterId -->
          <div *ngIf="selectedTrade[rosterId] as roster">
            <div class="roster-header">
              <img [src]="getRosterAvatar(roster.roster_id)" alt="{{ roster.user_name }}'s Avatar"
                class="roster-avatar" />
              <h3 class="roster-username">{{ roster.user_name }}</h3>
            </div>

            <div>
              <div class="value-container">
                <p>Total Current Value: {{ roster.total_current_value }}</p>

                <img *ngIf="roster.total_current_value > roster.total_value_when_traded"
                  src="assets/icons/stonks_up.png" alt="Value increased" class="value-change-icon" />
                <img *ngIf="roster.total_current_value < roster.total_value_when_traded"
                  src="assets/icons/stonks_down.jpg" alt="Value decreased" class="value-change-icon" />
              </div>

              <p>Total Value When Traded: {{ roster.total_value_when_traded }}</p>
            </div>
            <div *ngIf="roster.fab > 0">
              <p>FAB: ${{ roster.fab }}</p>
            </div>

            <!-- Display players for this roster -->
            <div *ngIf="roster.players.length > 0">
              <h5>Players:</h5>
              <ul>
                <li *ngFor="let player of roster.players">
                  <img [src]="getPlayerImageUrl(player.player_id)" alt="{{ player.player_name }}'s Avatar"
                    class="player-avatar" />
                  {{ player.player_name }}
                  <ul>
                    <li>Value When Traded: {{ player.value_when_traded == 0 ? '?' : player.value_when_traded }}</li>
                    <li>Latest Value:
                      {{
                      player.value_now_as_of === ''
                      ? '?'
                      : ' (' + player.value_now_as_of + '): ' + (player.latest_value === 0 ? '?' :
                      player.latest_value)
                      }}
                    </li>
                  </ul>
                </li>
              </ul>
            </div>

            <!-- Display draft picks for this roster -->
            <div *ngIf="roster.draft_picks.length > 0;">
              <ul>
                <h5>Draft Picks:</h5>
                <li *ngFor="let pick of roster.draft_picks">
                  {{ pick.description }}
                  <ul>
                    <li *ngIf="pick.player_drafted">{{ pick.player_drafted.player_name }}</li>
                    <li>Value When Traded: {{ pick.value_when_traded }}</li>
                    <li *ngIf="pick.player_drafted">Latest Value: {{ pick.player_drafted.latest_value }}</li>
                  </ul>
                </li>
              </ul>
            </div>

          </div>
        </div>
      </div>
      <div>
        <app-line-chart [trade]="selectedTrade"></app-line-chart>
      </div>
    </div>
  </div>
</div>